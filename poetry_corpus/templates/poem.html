{% extends "base.html" %}
{% load static from staticfiles %}
{% block custom_head %}
<script src="{% static 'js/ajax.csrf.js' %}"></script>
<script src="{% static 'js/poem.js' %}"></script>
{% endblock %}
{% block content %}
<div class="page-header">
    <h3>{{ poem.author }} - {{ poem.name }}</h3>
</div>
<div class="col-lg-6">
    <select class="form-control markup-selector">
        <option value="0">Automatic markup</option>
        {% for markup in poem.markups.all %}
            <option value="{{markup.pk}}" class="markup">{{ markup.author}}</option>
        {% endfor %}
    </select>
</div>
<div style="font-size: 20px; padding-top: 20px;" class="col-lg-9 poem" id="{{ poem.pk }}">
<p style="font-size: 15px;">Кликайте по слогами, чтобы менять ударение</p>
{% for line in text %}
    <p id="{{ forloop.counter0 }}" class="line">
    {% spaceless %}
    {% for word in line %}
        {% if word.word_number != -1 and word.word.syllables|length != 0 %}
        <span id="{{forloop.parentloop.counter0}}-{{ word.word_number }}" class="word">
            {% for syllable in word.word.syllables %}
                <a id="{{forloop.parentloop.parentloop.counter0}}-{{ word.word_number }}-{{ forloop.counter0 }}"
                    class="syllable
                    {% if syllable.accent != -1 %}
                        {% if syllable.omography %}
                        bck red
                        {% else %}
                        bck green
                        {% endif %}
                    {% else %}
                        {% if syllable.no_accents %}
                        bck red
                        {% else %}
                        bck default
                        {% endif %}
                    {% endif %}">{{syllable.text}}</a>
            {%  endfor %}
        </span>
        {% else %}
            <span>{% ifequal word.word.text " " %}&nbsp;{% else %}{{ word.word.text }}{% endifequal %}</span>
        {%  endif %}
    {%  endfor %}
    {% endspaceless %}
    </p>
{% endfor %}

{% if auto and user.is_authenticated %}
<div style="padding-top:20px;">
    <button class="btn btn-md btn-default send-markup">Отправить разметку</button>
</div>
{% endif %}
{% if auto and not user.is_authenticated  %}
<div>
    <p style="font-size: 15px;">Только авторизованные пользователи могут добавлять разметку.</p>
</div>
{% endif %}
</div>

{% if auto %}
<div class="col-lg-3">
    <h4>Классификатор (цифры - слоги)</h4>
    <p>Метр: {{ classifier.result_metre }}</p>
    <p>Неправильные ударения:
        {% for item in corrected_accents %}<p>{{ item }}</p> {% endfor %}
    </p>
    <p>Снятая омографая
        {% for item in omograph_resolutions %}<p>{{ item }}</p> {% endfor %}
    </p>
    <p>Новые ударения: {% for item in additions %}<p>{{ item }}</p> {% endfor %}</p>
    <p>ML: {% for item in after_ml %}<p>{{ item }}</p> {% endfor %}</p>
</div>
{% endif %}

{% csrf_token %}
{% endblock %}